<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Socket.IO 客户端测试</title>
</head>
<body>
  <h1>Socket.IO 测试页面</h1>
  <button id="sendBtn">发送文字消息</button>
  <br/><br/>
  <input type="file" id="voiceInput" accept="audio/*"/>
  <button id="sendVoiceBtn">发送语音消息</button>
  <ul id="log"></ul>
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client/dist/socket.io.min.js"></script>
  <script>
    const socket = io("http://localhost:8000", {
      path: "/socket.io",
      transports: ["websocket"]
    });

    socket.on("connect", () => log(`已连接（sid=${socket.id}）`));
    socket.on("chat_message", data => log(`文字消息：${data.from} ⇒ ${data.message}`));
    socket.on("voice_message", data => log(`语音消息：${data.from} ⇒ ${data.url}`));
    socket.on("disconnect", () => log("已断开"));

    document.getElementById("sendBtn").onclick = () => {
      socket.emit("chat_message", { from: "browser", message: "Hello from browser" });
    };

    document.getElementById("sendVoiceBtn").onclick = () => {
      const fileInput = document.getElementById("voiceInput");
      if (!fileInput.files.length) return alert("请先选一个音频文件");
      // 简单示例：假设你已经上传好了音频并拿到 URL，这里用占位符
      const fakeUrl = "https://your.cdn.com/voice/demo.mp3";
      socket.emit("voice_message", { from: "browser", to: "someUser", url: fakeUrl });
    };

    function log(msg) {
      const li = document.createElement("li");
      li.textContent = msg;
      document.getElementById("log").append(li);
    }
  </script>
</body>
</html>
